<!doctype html>

<title>CodeMirror: Autocomplete Demo</title>
<meta charset="utf-8"/>
<link rel=stylesheet href="../doc/docs.css">

<link rel="stylesheet" href="../lib/codemirror.css">
<link rel="stylesheet" href="../addon/hint/show-hint.css">
<script src="../lib/codemirror.js"></script>
<script src="../addon/hint/show-hint.js"></script>
<script src="../addon/edit/outline.js"></script>
<script src="../addon/mode/overlay.js"></script>
<script src="../mode/markdown/markdown.js"></script>

<style type="text/css">
    .CodeMirror {border: 1px solid black;}
    .cm-coffeebreakTag {color: #0fa; background-color: aliceblue; }
</style>

<div id=nav>
  <a href="http://codemirror.net"><h1>CodeMirror</h1><img id=logo src="../doc/logo.png"></a>

  <ul>
    <li><a href="../index.html">Home</a>
    <li><a href="../doc/manual.html">Manual</a>
    <li><a href="https://github.com/codemirror/codemirror">Code</a>
  </ul>
  <ul>
    <li><a class=active href="#">Autocomplete</a>
  </ul>
</div>

<article>
<h2>Autocomplete Demo</h2>
<form><textarea id="code" name="code">
# How to contribute

- [Getting help](#getting-help-)
- [Submitting bug reports](#submitting-bug-reports-)
- [Contributing code](#contributing-code-)
    
# Tagging

@tag at beginning is @valid, otherwise @@must@be preceded by space .@invalid.

@@invalid
@in@valid
    
xyz@example.com

Try it for yourself @task

## Getting help

Community discussion, questions, and informal bug reporting is done on the
[discuss.CodeMirror forum](http://discuss.codemirror.net).
    
## Submitting bug reports

The preferred way to report bugs is to use the
[GitHub issue tracker](http://github.com/codemirror/CodeMirror/issues). Before
reporting a bug, read these pointers.

**Note:** The issue tracker is for *bugs*, not requests for help. Questions
should be asked on the
[discuss.CodeMirror forum](http://discuss.codemirror.net) instead.
</textarea></form>

<p>Press <strong>ctrl-space</strong> to activate autocompletion. Built
on top of the <a href="../doc/manual.html#addon_show-hint"><code>show-hint</code></a>
and <a href="../doc/manual.html#addon_javascript-hint"><code>javascript-hint</code></a>
addons.</p>

    <script>
        // Dummy mode that puts words into their own token
        // (You probably have a mode already)
        /*
        CodeMirror.defineMode("mylanguage", function() {
            return {token: function(stream, state) {
                if (stream.match(/[@\w+]/)) return "variable";
                stream.next();
                return null;
            }};
        });
        */
        
        CodeMirror.defineMode("coffeebreak", function(config, parserConfig) {
            var coffeebreakOverlay = {
                token: function(stream, state) {
                    var matchedPart;
                    if ((matchedPart = stream.match(/^(@\w+)(\s|[,;:]|$)/)) != null) {
                        // console.log(matchedPart);
                        // console.log("Backing up " + matchedPart[2].length + " chars");
                        stream.backUp(matchedPart[2].length);
                        return "coffeebreakTag";
                    }
                    else {
                        // var skippedPart = stream.match(/^.*(?:\s@\w+)/);
                        var skippedPart = stream.match(/^[^\s]*(\s+|$)/);
                        // console.log(skippedPart);
                        // if (skippedPart == null) stream.skipToEnd();
                        return null;
                    }
                }
            };
            return CodeMirror.overlayMode(CodeMirror.getMode(config, "markdown"), coffeebreakOverlay);
        });
        
        // Register an array of completion words for this mode
        // CodeMirror.registerHelper("hintWords", "mylanguage",
        //                           ["cat", "dog", "bird"]);
        
        function scriptHint(editor, options) {
            // Find the token at the cursor
            var cur = editor.getCursor(), token = editor.getTokenAt(cur);
            console.log("Current token " + token);
            
            if (options.type == "@")
                return CodeMirror.hint.fromList(editor, {words: ["cat", "dog", "bird"]});
            else if (options.type == "#")
                return CodeMirror.hint.fromList(editor, {words: ["Buffalo", "New York", "Los Angeles"]});
        };
        CodeMirror.registerHelper("hint", "markdown", scriptHint);


        // Create an editor
        var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
            lineNumbers: true,
            // extraKeys: { '@': "autocomplete" },
            theme: "default",
            mode: {name: "coffeebreak", globalVars: true},
            indentUnit: 4,
            extraKeys: {"Enter": "newlineAndIndentContinueMarkdownList", "Tab": "indentMarkdownListMore"}
        });
        
        // When an @ is typed, activate completion
        editor.on("inputRead", function(editor, change) {
            if (change.text[0] == "@")
                editor.showHint({ type: "@" });
            else if (change.text[0] == "#")
                editor.showHint({ type: "#" });
        });
    </script>
</article>
